<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Predicting the FIFA Club World Cup — Machine Learning Project</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0f17;
      --panel:#121826;
      --panel-2:#192235;
      --text:#e7ecf7;
      --muted:#b8c2d9;
      --line:#273246;
      --accent:#5eead4;
      --accent-2:#8b5cf6;
      --accent-3:#38bdf8;
      --ring: rgba(94,234,212,.35);
      --radius:16px;
      --shadow: 0 12px 40px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    html{ scroll-behavior:smooth; } /* fallback smooth scroll */
    body{
      margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color:var(--text); background:
        radial-gradient(1200px 900px at -10% -20%, #1b2140 0%, transparent 55%),
        radial-gradient(1200px 900px at 110% 0%, #16234c 0%, transparent 55%),
        linear-gradient(180deg, #0b1022, var(--bg));
    }

    .noise{ position:fixed; inset:0; pointer-events:none; opacity:.025; mix-blend-mode:soft-light;
      background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.5"/></svg>');
    }

    /* Layout */
    .container{ max-width:1100px; margin:0 auto; padding:24px 18px 80px; }
    header{ position:sticky; top:0; z-index:20; backdrop-filter:saturate(140%) blur(10px);
      background:linear-gradient(180deg, rgba(11,15,23,.75), rgba(11,15,23,.35));
      border-bottom:1px solid rgba(255,255,255,.06);
      transition: background .5s ease;
    }
    header.pulse{
      animation: headerPulse 900ms ease;
    }
    @keyframes headerPulse{
      0% { background:linear-gradient(180deg, rgba(18,26,45,.85), rgba(11,15,23,.35)); }
      50%{ background:linear-gradient(180deg, rgba(24,38,70,.95), rgba(11,15,23,.45)); }
      100%{ background:linear-gradient(180deg, rgba(11,15,23,.75), rgba(11,15,23,.35)); }
    }
    .nav{ max-width:1100px; margin:0 auto; display:flex; gap:14px; align-items:center; padding:14px 18px; }
    .brand{ font-weight:800; letter-spacing:.3px; }
    .brand em{ font-family:"Playfair Display", serif; font-weight:700; font-style:normal; }
    .spacer{ flex:1 }
    .nav a{ color:var(--muted); text-decoration:none; font-weight:600; font-size:14px; padding:8px 10px; border-radius:10px; transition:color .2s ease, background .2s ease; }
    .nav a:hover{ color:var(--text); background:rgba(255,255,255,.06); }

    /* Hero */
    .hero{
      display:grid; grid-template-columns: 1.25fr .9fr; gap:28px;
      padding:48px 0 26px; align-items:center;
    }
    @media (max-width: 980px){ .hero{ grid-template-columns:1fr; } }
    .hero h1{
      font-family:"Playfair Display", serif; font-weight:700;
      font-size: clamp(28px, 5vw, 52px); line-height:1.05; margin:0 0 10px;
      background: linear-gradient(90deg, var(--accent), var(--accent-2), var(--accent-3));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      filter: drop-shadow(0 8px 24px rgba(56,189,248,.18));
      animation: shimmer 8s ease-in-out infinite; background-size:200% 200%;
    }
    @keyframes shimmer{ 0%,100%{background-position:0% 50%} 50%{background-position:100% 50%} }
    .lead{ color:var(--muted); font-size: clamp(15px, 2.2vw, 18px); line-height:1.7; margin:8px 0 16px; }
    .hero-figure{
      position:relative; border-radius:var(--radius); overflow:hidden;
      background:linear-gradient(180deg, var(--panel), var(--panel-2));
      box-shadow: var(--shadow); outline:1px solid rgba(255,255,255,.06);
      transform: translateY(6px); animation: floatIn .8s .05s both cubic-bezier(.2,.8,.2,1);
      aspect-ratio: 16/9;
    }
    .hero-figure img{ width:100%; height:100%; display:block; object-fit:cover; }
    .shine{ position:absolute; inset:0; background:linear-gradient(120deg, transparent 40%, rgba(255,255,255,.28) 50%, transparent 60%); transform:translateX(-100%); transition:transform .9s ease; }
    .hero-figure:hover .shine{ transform:translateX(120%); }

    .chips{ display:flex; flex-wrap:wrap; gap:8px; margin:12px 0 0; }
    .chip{
      font-size:12px; font-weight:700; letter-spacing:.3px; color:#0d1324;
      padding:6px 10px; border-radius:999px; background:linear-gradient(90deg, var(--accent), var(--accent-2));
      box-shadow:0 6px 20px rgba(139,92,246,.35);
    }

    /* Sections */
    section{
      margin:40px 0 0; padding:26px 20px; border:1px solid rgba(255,255,255,.06);
      border-radius:var(--radius); background:linear-gradient(180deg, var(--panel), var(--panel-2)); box-shadow: var(--shadow);
      animation: floatIn .8s both cubic-bezier(.2,.8,.2,1);
      scroll-margin-top: 90px; /* avoid being hidden under sticky header on jump */
    }
    section:nth-of-type(1){ animation-delay:.05s } section:nth-of-type(2){ animation-delay:.1s }
    section:nth-of-type(3){ animation-delay:.15s } section:nth-of-type(4){ animation-delay:.2s }
    section:nth-of-type(5){ animation-delay:.25s } section:nth-of-type(6){ animation-delay:.3s }
    @keyframes floatIn{ from{opacity:0; transform: translateY(10px)} to{opacity:1; transform:none} }

    /* Destination flash highlight after jump */
    section.flash{
      box-shadow: 0 0 0 3px rgba(94,234,212,.35), var(--shadow);
      animation: sectionFlash 1100ms ease;
    }
    @keyframes sectionFlash{
      0%{ box-shadow: 0 0 0 12px rgba(94,234,212,.0), var(--shadow); }
      30%{ box-shadow: 0 0 0 6px rgba(94,234,212,.45), var(--shadow); }
      100%{ box-shadow: 0 0 0 3px rgba(94,234,212,.0), var(--shadow); }
    }

    h2{ margin:0 0 10px; font-size: clamp(20px, 3.2vw, 28px); line-height:1.2; letter-spacing:.2px; }
    .sub{ margin:0 0 16px; color:var(--muted); font-size:14px; }
    p{ margin:8px 0 10px; line-height:1.75; color:var(--text); }
    a[target="_blank"]{ color:#9fd7ff; text-underline-offset:3px }
    hr.sep{ border:0; border-top:1px solid var(--line); margin:18px 0 }

    /* Figures / images — uniform card sizes + zoom hint */
    figure{ margin:16px 0; }
    .img-card{
      position:relative;
      overflow:hidden; border-radius:12px; border:1px solid rgba(255,255,255,.08);
      background:#0e1424;
      /* Make all figures the same height by default */
      aspect-ratio: 16 / 9;
    }
    .img-card img{
      display:block; width:100%; height:100%;
      object-fit: cover; /* gentle crop for consistency */
      transition: transform .6s ease;
      cursor: zoom-in;
    }
    .img-card:hover img{ transform: scale(1.03); }
    .img-card::after{
      content:"Click to zoom";
      position:absolute; right:10px; bottom:10px;
      font-size:12px; font-weight:700; letter-spacing:.3px; color:#0d1324;
      padding:6px 10px; border-radius:999px;
      background:linear-gradient(90deg, var(--accent), var(--accent-2));
      opacity:.0; transform: translateY(6px);
      transition: .25s ease;
      pointer-events:none;
    }
    .img-card:hover::after{ opacity:.9; transform:none; }

    /* Optional: show full image (no cropping) by adding .no-crop to figure */
    .img-card.no-crop{ aspect-ratio:auto; }
    .img-card.no-crop img{ object-fit: contain; height:auto; }

    figcaption{ font-size:13px; color:var(--muted); padding:10px 6px 0 }

    /* Grid helpers */
    .grid{ display:grid; gap:18px; }
    .cols-2{ grid-template-columns: repeat(2, 1fr); }
    .cols-3{ grid-template-columns: repeat(3, 1fr); }
    @media (max-width: 900px){ .cols-2,.cols-3{ grid-template-columns: 1fr; } }

    /* Tables */
    .table{
      width:100%; border-collapse: collapse; overflow:hidden; border-radius:12px; border:1px solid rgba(255,255,255,.08);
    }
    .table th, .table td{ padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.06); text-align:left; font-size:14px; }
    .table th{ background:rgba(255,255,255,.04); font-weight:800; }
    .table tr:hover td{ background:rgba(255,255,255,.03); }

    /* Details dropdowns */
    details{ border:1px dashed rgba(255,255,255,.15); border-radius:10px; padding:10px 12px; }
    details[open]{ background:rgba(255,255,255,.03); }
    summary{ cursor:pointer; font-weight:800; }

    /* Footer */
    footer{ text-align:center; color:var(--muted); padding:20px 0 60px; }

    /* Scroll reveal */
    .reveal{ opacity:0; transform: translateY(10px); transition: .6s ease; }
    .reveal.show{ opacity:1; transform:none; }

    /* Lightbox */
    .lightbox{
      position:fixed; inset:0; z-index:1000;
      display:flex; align-items:center; justify-content:center;
      background: rgba(7,10,18,.78);
      backdrop-filter: blur(4px);
      padding: 24px;
      opacity:0; pointer-events:none;
      transition: opacity .25s ease;
    }
    .lightbox.show{ opacity:1; pointer-events:auto; }
    .lightbox-inner{ max-width: min(92vw, 1400px); max-height: 86vh; display:flex; flex-direction:column; align-items:center; gap:10px; }
    .lightbox-img{
      max-width: 100%; max-height: 86vh; border-radius:14px;
      box-shadow: 0 25px 80px rgba(0,0,0,.6); outline:1px solid rgba(255,255,255,.1);
    }
    .lightbox-caption{ color:var(--muted); font-size:13px; text-align:center; }
    .lb-close, .lb-prev, .lb-next{
      position:fixed; top:50%; transform: translateY(-50%);
      background: rgba(255,255,255,.08); color:var(--text);
      border:1px solid rgba(255,255,255,.15); border-radius:12px; padding:10px 12px;
      cursor:pointer; font-weight:800;
    }
    .lb-close{ top:24px; right:24px; transform:none; }
    .lb-prev{ left:20px; }
    .lb-next{ right:20px; }
    .lb-close:hover, .lb-prev:hover, .lb-next:hover{ background:rgba(255,255,255,.16); }
    @media (max-width: 800px){
      .lb-prev, .lb-next{ display:none; }
    }
  </style>
</head>
<body>
  <div class="noise" aria-hidden="true"></div>

  <!-- Sticky Nav -->
  <header id="site-header">
    <nav class="nav">
      <div class="brand"><em>Club World Cup</em> — ML Project</div>
      <div class="spacer"></div>
      <a class="navlink" href="#intro">Intro</a>
      <a class="navlink" href="#background">Background</a>
      <a class="navlink" href="#methods">Methods</a>
      <a class="navlink" href="#analysis">Analysis</a>
      <a class="navlink" href="#results">Results</a>
      <a class="navlink" href="#conclusion">Conclusion</a>
    </nav>
  </header>

  <main class="container">
    <!-- Hero -->
    <div class="hero">
      <div>
        <h1>Predicting the FIFA Club World Cup</h1>
        <p class="lead">
          I trained gradient-boosting models on 228,000+ historical matches and simulated the Club World Cup 10,000 times to estimate each team’s chances. My best model (XGBoost) produced rankings close to the professional Opta Supercomputer—using only free data and one home PC—and I built a small demo showing how this could power live predictions and AI commentary.
        </p>
        <div class="chips">
          <span class="chip">XGBoost / LightGBM / CatBoost</span>
          <span class="chip">228k+ matches</span>
          <span class="chip">10k tournament sims</span>
          <span class="chip">Spearman 0.647</span>
        </div>
      </div>
      <a class="hero-figure" href="https://simulationshowcase.streamlit.app" target="_blank" rel="noopener noreferrer" aria-label="Open live demo (opens in a new tab)">
        <img src="hero_banner.jpg" alt="Tournament prediction hero banner" />
        <span class="shine" aria-hidden="true"></span>
      </a>
    </div>

    <!-- Intro -->
    <section id="intro" class="reveal">
      <h2>Research Question</h2>
      <p><strong>Can machine learning models accurately predict the winner of the FIFA Club World Cup using past match data, and can these models support live predictions and AI commentary?</strong></p>
      <hr class="sep">
      <h2>Introduction</h2>
      <p>
        Football is notoriously hard to predict: few goals, high variance, and many hidden factors. Professional systems like Opta process huge volumes of real-time data with multiple models and supercomputers. I set out to build a useful alternative with public data and consumer hardware, then benchmark it against Opta.
      </p>

      <div class="grid cols-3">
        <div><h3>Key Terms</h3>
          <ul>
            <li><strong>xG</strong>: likelihood a shot becomes a goal (position/type/assist).</li>
            <li><strong>Elo Rating</strong>: rating based on results & opponent strength.</li>
            <li><strong>SHAP</strong>: explains feature contribution to a prediction.</li>
            <li><strong>Spearman correlation</strong>: how well predicted ranks match actual (1 = perfect).</li>
          </ul>
        </div>
        <div><h3>Aims</h3>
          <p>Predict the tournament winner using ML and compare to a random baseline and a professional model. Build a small web demo to illustrate real-time potential.</p>
        </div>
        <div><h3>Hypotheses</h3>
          <ul>
            <li>XGBoost Spearman rank correlation between <strong>0.45–0.65</strong>.</li>
            <li>Feasible pipeline for <strong>real-time AI commentary</strong> (simulated).</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Background -->
    <section id="background" class="reveal">
      <h2>Background</h2>
      <p><strong>Why football is hard:</strong> low-scoring, randomness, injuries, travel, refereeing, and luck; even elite models get ~60–70% match accuracy.</p>
      <p><strong>How the pros do it:</strong> Opta uses petabytes of data, 8 AI models, and millions of simulations; their Club World Cup probabilities provide a benchmark.</p>
      <p><strong>Tournament format:</strong> 32 teams → group stage (8×4; top-2 advance) → knockouts (R16 → QF → SF → Final; ET & penalties if needed).</p>
      <details>
        <summary>See tournament diagram</summary>
        <figure class="img-card">
          <img src="format_diagram.png" alt="Club World Cup format diagram" />
          <figcaption>Group and knockout structure used for simulations.</figcaption>
        </figure>
      </details>
    </section>

    <!-- Variables -->
    <section class="reveal">
      <h2>Variables & Controls</h2>
      <div class="grid cols-2">
        <div>
          <table class="table">
            <thead><tr><th>Type</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td>Independent</td><td>Match features (xG, Elo, injuries, form, odds)</td></tr>
              <tr><td>Dependent</td><td>Predicted outcome & tournament winner</td></tr>
              <tr><td>Controlled</td><td>Hyperparameters, simulation rules, feature engineering steps</td></tr>
            </tbody>
          </table>
        </div>
        <div>
          <table class="table">
            <thead><tr><th>Controlled Variable</th><th>Significance</th><th>How Controlled</th></tr></thead>
            <tbody>
              <tr><td>Simulation Rules</td><td>Consistency</td><td>Identical groups + knockout rules</td></tr>
              <tr><td>Hyperparameters</td><td>Affects accuracy</td><td>Fixed grid search settings across models</td></tr>
              <tr><td>Dataset Features</td><td>Prevents leakage</td><td>Only pre-match features</td></tr>
              <tr><td>Data Cleaning</td><td>Bias control</td><td>Removed post-match stats (final score, cards, etc.)</td></tr>
            </tbody>
          </table>
        </div>
      </div>
      <p class="sub">All definitions and tables follow the report.</p>
    </section>

    <!-- Methods -->
    <section id="methods" class="reveal">
      <h2>Methods</h2>
      <h3>Data Collection</h3>
      <p>Aggregated public datasets covering domestic and continental competitions, shot-based xG, injuries, and match metadata (2000–2025). Steps: load & normalize names, merge by match/date, remove outcome columns, assemble 228k+ matches of pre-match features.</p>
      <ul>
        <li>Club Match Data (42 leagues): <a href="https://github.com/xgabora/Club-Football-Match-Data-2000-2025" target="_blank" rel="noopener">GitHub</a> / <a href="https://www.kaggle.com/datasets/adamgbor/club-football-match-data-2000-2025" target="_blank" rel="noopener">Kaggle</a></li>
        <li>Understat shots/xG (scraped): <a href="https://github.com/douglasbc/scraping-understat-dataset" target="_blank" rel="noopener">GitHub</a></li>
        <li>Injuries: <a href="https://www.kaggle.com/datasets/amritbiswas007/player-injuries-and-team-performance-dataset" target="_blank" rel="noopener">Kaggle</a></li>
        <li>FootyStats continental comps: <a href="https://footystats.org/africa/caf-champions-league" target="_blank" rel="noopener">CAF</a>, <a href="https://footystats.org/asia/afc-champions-league" target="_blank" rel="noopener">AFC</a>, <a href="https://footystats.org/international/ofc-champions-league" target="_blank" rel="noopener">OFC</a></li>
        <li>Football-Data.co.uk (domestic): <a href="http://football-data.co.uk/" target="_blank" rel="noopener">Index</a>, <a href="https://www.football-data.co.uk/brazil.php" target="_blank" rel="noopener">Brazil</a>, <a href="https://www.football-data.co.uk/mexico.php" target="_blank" rel="noopener">Mexico</a>, <a href="https://www.football-data.co.uk/portugalm.php" target="_blank" rel="noopener">Portugal</a></li>
      </ul>
      <figure class="img-card">
        <img src="data_pipeline.png" alt="Data aggregation and cleaning pipeline" />
        <figcaption>Data pipeline: load → normalize → merge → de-leak → features.</figcaption>
      </figure>

      <h3>Model Training</h3>
      <p>Compared <strong>XGBoost</strong>, <strong>LightGBM</strong>, and <strong>CatBoost</strong> (PyCaret for quick baselines, MCC selection). Generated feature importance and SHAP explanations to interpret drivers.</p>
      <div class="grid cols-2">
        <figure class="img-card">
          <img src="feature_importance.png" alt="Feature importance bar chart" />
          <figcaption>Feature importance highlights.</figcaption>
        </figure>
        <figure class="img-card">
          <img src="shap_summary.png" alt="SHAP summary plot" />
          <figcaption>SHAP summary: feature effects distribution.</figcaption>
        </figure>
      </div>

      <h3>Predicting the Club World Cup</h3>
      <ol>
        <li>Generate pre-match data for each CWC game.</li>
        <li>Predict each match with the trained model.</li>
        <li>Advance winners through groups → knockouts.</li>
        <li>Repeat for <strong>10,000</strong> tournaments; compute team win %.</li>
      </ol>

      <details>
        <summary>Random Baseline (expected ~3.125% per team)</summary>
        <p>Purely random outcomes in groups (win/draw/loss = 1/3) and 50/50 in knockouts; same structure as the real event; 10,000 reps to form the baseline distribution.</p>
        <figure class="img-card">
          <img src="random_baseline_code.png" alt="Random baseline code screenshot" />
          <figcaption>Random baseline simulation script (summary).</figcaption>
        </figure>
      </details>

      <details>
        <summary>Professional Benchmark (Opta)</summary>
        <p>Used Opta Supercomputer’s CWC win probabilities as the professional benchmark, then simulated 10,000 tournaments from those probabilities to compare distributions and ranks.</p>
        <figure class="img-card">
          <img src="opta_table.png" alt="Opta-based win probability table" />
          <figcaption>Opta-derived ranking table used for comparison.</figcaption>
        </figure>
      </details>
    </section>

    <!-- Analysis -->
    <section id="analysis" class="reveal">
      <h2>Data Analysis & Evaluation</h2>
      <p>
        I compared three systems—my XGBoost model, Opta, and a random baseline—using four views: side-by-side ranks, Spearman correlation, mean absolute rank error (MARE), and the predicted win probability assigned to the real winner (Chelsea).
      </p>

      <div class="grid cols-2">
        <figure class="img-card">
          <img src="rank_comparison.png" alt="Rank comparison chart" />
          <figcaption>Team rank comparison vs. actual.</figcaption>
        </figure>
        <figure class="img-card">
          <img src="rank_comparison_no_random.png" alt="Rank comparison without random baseline" />
          <figcaption>Same chart without the random baseline for clarity.</figcaption>
        </figure>
      </div>

      <div class="grid cols-3">
        <figure class="img-card">
          <img src="spearman_bar.png" alt="Spearman correlation bar chart" />
          <figcaption>Spearman: XGBoost <strong>0.647</strong>, Opta 0.691, Random −0.323.</figcaption>
        </figure>
        <figure class="img-card">
          <img src="mare_bar.png" alt="Mean absolute rank error chart" />
          <figcaption>MARE: XGBoost 6.56, Opta 5.28, Random 12.31.</figcaption>
        </figure>
        <figure class="img-card">
          <img src="winner_probability.png" alt="Win probability for Chelsea across models" />
          <figcaption>Win % for actual winner (Chelsea): Random 3.19%, XGBoost 6.04%, Opta 8.40%.</figcaption>
        </figure>
      </div>

      <details>
        <summary>Model notes & data leakage fix</summary>
        <p>Early runs showed 99–100% “accuracy”, revealing leakage from post-match stats. After removing them, results normalized and became realistic.</p>
      </details>
    </section>

    <!-- Results / My Model -->
    <section id="results" class="reveal">
      <h2>My Model Results</h2>
      <p>
        XGBoost was the best performer for this structured dataset. I simulated ~630,000 matches (63 per tournament × 10,000 tournaments), which took ~19h30m on a single home PC (RTX 3080 Ti). Final ranking correlation with actual results: <strong>Spearman 0.647</strong>—far above random (−0.323) and close to Opta (0.691).
      </p>
      <div class="grid cols-2">
        <figure class="img-card">
          <img src="my_model_table.png" alt="My model win% table (top teams)" />
          <figcaption>Example win % table across 10,000 simulations.</figcaption>
        </figure>
        <figure class="img-card">
          <img src="runtime_hardware.png" alt="Runtime and hardware panel" />
          <figcaption>Runtime & hardware notes (single-machine pipeline).</figcaption>
        </figure>
      </div>

      <h3>Resource Comparison</h3>
      <p>
        Opta (Stats Perform) uses ~7.2 PB of sports data, 8 AI models across >200 programs, supercomputers, and a large team; my project used public data and one GPU. Estimated annual electricity: <strong>~NZD 920</strong> for my GPU vs. <strong>~NZD 13.14M</strong> for a supercomputer-scale setup—illustrating the resource gap while showing what’s possible with accessible tools.
      </p>
      <figure class="img-card">
        <img src="resource_compare.png" alt="Resource comparison infographic" />
        <figcaption>Resources: professional vs. single-PC project.</figcaption>
      </figure>

      <h3>Live Demo</h3>
      <p>
        I built a simple demo to preview real-time usage: choose a match, generate realistic stats, predict a winner, and display commentary. Try it here:
        <a href="https://simulationshowcase.streamlit.app" target="_blank" rel="noopener">simulationshowcase.streamlit.app</a>.
      </p>
    </section>

    <!-- Conclusion -->
    <section id="conclusion" class="reveal">
      <h2>Conclusion</h2>
      <p>
        The model landed at the top of my expected range (Spearman <strong>0.647</strong>), cut mean rank error by ~47% vs. random, and assigned a realistic win chance to the eventual champion (Chelsea). The pipeline can power a basic live-prediction demo today and could approach professional performance with richer player-level and situational data.
      </p>
      <p class="sub">
        All text, numbers, and structure summarize my “2025 SCIENCE FAIR” report.
      </p>
    </section>

    <footer>
      © <span id="year"></span> Asher Tenenbaum · All external links open in a new tab
    </footer>
  </main>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" aria-hidden="true">
    <button class="lb-close" id="lbClose" aria-label="Close">✕</button>
    <button class="lb-prev" id="lbPrev" aria-label="Previous">‹</button>
    <div class="lightbox-inner">
      <img class="lightbox-img" id="lbImg" alt="">
      <div class="lightbox-caption" id="lbCap"></div>
    </div>
    <button class="lb-next" id="lbNext" aria-label="Next">›</button>
  </div>

  <script>
    // Current year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Reveal on scroll
    const obs = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('show'); obs.unobserve(e.target);} });
    },{threshold:.08});
    document.querySelectorAll('.reveal').forEach(el => obs.observe(el));

    // Smooth anchor scroll + header pulse + destination flash
    const header = document.getElementById('site-header');
    document.querySelectorAll('a.navlink[href^="#"]').forEach(link=>{
      link.addEventListener('click', (e)=>{
        const id = link.getAttribute('href').slice(1);
        const target = document.getElementById(id);
        if(!target) return;
        e.preventDefault();

        // pulse header background
        header.classList.remove('pulse');
        void header.offsetWidth; // reflow to restart animation
        header.classList.add('pulse');

        // smooth scroll (account for sticky header via scroll-margin-top in CSS)
        target.scrollIntoView({behavior:'smooth', block:'start'});

        // flash highlight after a short delay
        setTimeout(()=>{
          target.classList.add('flash');
          setTimeout(()=>target.classList.remove('flash'), 1100);
        }, 400);
      });
    });

    // Lightbox for images in figures (click to zoom)
    const zoomables = Array.from(document.querySelectorAll('figure.img-card img'));
    const lb = document.getElementById('lightbox');
    const lbImg = document.getElementById('lbImg');
    const lbCap = document.getElementById('lbCap');
    const lbClose = document.getElementById('lbClose');
    const lbPrev = document.getElementById('lbPrev');
    const lbNext = document.getElementById('lbNext');
    let idx = -1;

    function openLB(i){
      idx = i;
      const img = zoomables[idx];
      lbImg.src = img.currentSrc || img.src;
      lbImg.alt = img.alt || '';
      const capEl = img.closest('figure').querySelector('figcaption');
      lbCap.textContent = capEl ? capEl.innerText : '';
      lb.classList.add('show');
      lb.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
    }
    function closeLB(){
      lb.classList.remove('show');
      lb.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
      lbImg.src = '';
    }
    function nextLB(step){
      if(idx < 0) return;
      idx = (idx + step + zoomables.length) % zoomables.length;
      openLB(idx);
    }

    zoomables.forEach((img,i)=>{
      img.addEventListener('click', ()=> openLB(i));
      img.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') openLB(i); });
      img.setAttribute('tabindex','0'); // keyboard accessible
      img.setAttribute('role','button');
      img.setAttribute('aria-label','Open image in lightbox');
    });

    lbClose.addEventListener('click', closeLB);
    lb.addEventListener('click', (e)=>{ if(e.target === lb) closeLB(); }); // click backdrop
    lbPrev.addEventListener('click', ()=> nextLB(-1));
    lbNext.addEventListener('click', ()=> nextLB(1));

    window.addEventListener('keydown', (e)=>{
      if(!lb.classList.contains('show')) return;
      if(e.key === 'Escape') closeLB();
      if(e.key === 'ArrowLeft') nextLB(-1);
      if(e.key === 'ArrowRight') nextLB(1);
    });
  </script>
</body>
</html>
